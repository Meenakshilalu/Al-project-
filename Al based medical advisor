# Login View
def login(request):
   if request.method == "POST":
       email = request.POST['email']
       password = request.POST['password']
       user = authenticate(username=email, password=password)
       if user is not None:
           if user.usertype == 'admin':
               return redirect('/adminHome')
           elif user.usertype == 'User':
               request.session['uid'] = user.id
               return redirect('/userHome')
           elif user.usertype == 'Doctor':
               request.session['uid'] = user.id
               return redirect('/doctorHome')
           elif user.usertype == 'Pharmacist':
               request.session['uid'] = user.id
               return redirect('/pharmaHome')
       else:
           messages.error(request, "Invalid Credentials")
   return render(request, 'login.html')
 
# Doctor Registration
def doctor_register(request):
   if request.method == "POST":
       email = request.POST.get("email")
       if Login.objects.filter(username=email).exists():
           messages.error(request, "User already exists")
       else:
           new_user = Login.objects.create_user(
               username=email,
               password=request.POST.get("password"),
               usertype="Doctor",
               is_active=0,
           )
           Doctor.objects.create(
               name=request.POST.get("name"),
               email=email,
               phone=request.POST.get("phone"),
               address=request.POST.get("address"),
               medical_license_number=request.POST.get("medical_license_number"),
               specialization=request.POST.get("specialization"),
               image=request.FILES["image"],
               loginId=new_user,
           )
           messages.success(request, "Doctor registration successful. You can now log in.")
           return redirect("/login")
   return render(request, "doctor_reg.html")
 
# Pharmacist Registration
def pharmacist_register(request):
   if request.method == "POST":
       email = request.POST.get("email")
       if Login.objects.filter(username=email).exists():
           messages.error(request, "User already exists")
       else:
           new_user = Login.objects.create_user(
               username=email,
               password=request.POST.get("password"),
               usertype="Pharmacist",
               is_active=0,
           )
           Pharmacist.objects.create(
               name=request.POST.get("name"),
               email=email,
               phone=request.POST.get("phone"),
               address=request.POST.get("address"),
               pharmacy_license_number=request.POST.get("pharmacy_license_number"),
               pharmacy_name=request.POST.get("pharmacy_name"),
               image=request.FILES["image"],
               loginId=new_user,
           )
           messages.success(request, "Registration successful. You can now log in.")
           return redirect("/login")
   return render(request, "pharmacist_reg.html")
 
# User Registration
def user_register(request):
   if request.method == "POST":
       email = request.POST.get("email")
       if Login.objects.filter(username=email).exists():
           messages.error(request, "User already exists")
       else:
           new_user = Login.objects.create_user(
               username=email,
               password=request.POST.get("password"),
               usertype="User",
               is_active=1,
           )
           User.objects.create(
               name=request.POST.get("name"),
               email=email,
               phone=request.POST.get("phone"),
               address=request.POST.get("address"),
               age=request.POST.get("age"),
               gender=request.POST.get("gender"),
               blood_group=request.POST.get("blood_group"),
               image=request.FILES["image"],
               loginId=new_user,
           )
           messages.success(request, "User registration successful.")
   return render(request, "register.html")
 
# Admin Views
def adminHome(request):
   return render(request, 'Admin/index.html')
 
def admin_view_doctors(request):
   data = Doctor.objects.all()
   return render(request, 'Admin/admin_view_doctors.html', {'data': data})
 
def approve_doctor(request):
   did = request.GET.get('did')
   Login.objects.filter(id=did).update(is_active=1)
   return redirect("/admin_view_doctors")
 
def reject_doctor(request):
   did = request.GET.get('did')
   Doctor.objects.filter(loginId_id=did).delete()
   Login.objects.filter(id=did).delete()
   return redirect("/admin_view_doctors")
 
# Pharmacist Views
def pharmaHome(request):
   return render(request, "Pharmacist/index.html")
 
def addmedicine(request):
   if request.method == "POST":
       Medicine.objects.create(
           name=request.POST.get('name'),
           price=request.POST.get('price'),
           desc=request.POST.get('desc'),
           qty=request.POST.get('qty'),
           date=request.POST.get('date'),
           expiry=request.POST.get('expiry'),
           side_effects=request.POST.get('side_effects'),
           orginal_Price=request.POST.get('orginal_Price'),
           image=request.FILES["image"],
       )
       messages.success(request, "Medicine added successfully.")
       return redirect('/view_medicine')
   return render(request, 'Pharmacist/addmedicine.html')
 
# Doctor Views
def doctorHome(request):
   return render(request, 'doctor/index.html')
 
def prescription_patient(request):
   if request.method == "POST":
       Prescription.objects.create(
           doctor=Doctor.objects.get(loginId=request.session['uid']),
           uid=User.objects.get(id=request.POST.get('user_id')),
           pharmacist=Pharmacist.objects.get(id=request.POST.get('pharmacist_id')),
           medicines=request.POST.get('medicines'),
           instructions=request.POST.get('instructions'),
       )
       messages.success(request, "Prescription created successfully.")
       return redirect('/doctorHome')
   return render(request, 'doctor/prescription_patient.html')
 
# User Views
def userHome(request):
   return render(request, 'User/index.html')
 
def book_appoinment(request):
   if request.method == "POST":
       Appointments.objects.create(
           uid=User.objects.get(loginId=request.session['uid']),
           did=Doctor.objects.get(id=request.POST.get('dr_id')),
           date=request.POST.get('date'),
           time=request.POST.get('time'),
           desc=request.POST.get('desc'),
           status="Booked",
       )
       messages.success(request, "Appointment booked successfully.")
       return redirect("/userHome")
   return render(request, 'user/book_appointment.html')
 
def medicine_payment(request):
   if request.method == "POST":
       with transaction.atomic():
           order = MedicineOrder.objects.get(id=request.POST.get('id'))
           order.status = "Paid"
           order.save()
           order.mid.qty -= order.qty
           order.mid.save()
           messages.success(request, "Payment successful.")
   return render(request, 'User/medicine_payment.html')
 
URLS.PY
from django.contrib import admin
from django.urls import path
from myapp import views
 
urlpatterns = [
   path('admin/', admin.site.urls),
 
   # Authentication and Registration
   path('', views.index, name='index'),
   path('login/', views.login, name='login'),
   path('user_register/', views.user_register, name='user_register'),
   path('doctor_register/', views.doctor_register, name='doctor_register'),
   path('pharmacist_register/', views.pharmacist_register, name='pharmacist_register'),
 
   # Admin Views
   path('adminHome/', views.adminHome, name='adminHome'),
   path('admin_view_doctors/', views.admin_view_doctors, name='admin_view_doctors'),
   path('approve_doctor/', views.approve_doctor, name='approve_doctor'),
   path('reject_doctor/', views.reject_doctor, name='reject_doctor'),
   path('admin_view_phar/', views.admin_view_phar, name='admin_view_phar'),
   path('accept_pharma/', views.accept_pharma, name='accept_pharma'),
   path('reject_pharma/', views.reject_pharma, name='reject_pharma'),
   path('profit_report/', views.profit_report, name='profit_report'),
   path('SoldMedicine/', views.SoldMedicine, name='SoldMedicine'),
   path('adm_viewMedicine/', views.adm_viewMedicine, name='adm_viewMedicine'),
   path('expiredStock/', views.expiredStock, name='expiredStock'),
 
   # Pharmacist Views
   path('pharmaHome/', views.pharmaHome, name='pharmaHome'),
   path('pharmacist_Profile/', views.pharmacist_Profile, name='pharmacist_Profile'),
   path('update_pharmacist_Profile/', views.update_pharmacist_Profile, name='update_pharmacist_Profile'),
   path('addmedicine/', views.addmedicine, name='addmedicine'),
   path('view_medicine/', views.view_medicine, name='view_medicine'),
   path('Update_Medicine/', views.Update_Medicine, name='Update_Medicine'),
   path('delete_med/', views.delete_med, name='delete_med'),
   path('ph_view_prescription/', views.ph_view_prescription, name='ph_view_prescription'),
   path('sales_Medicine/', views.sales_Medicine, name='sales_Medicine'),
   path('pharmacist_view_orders/', views.pharmacist_view_orders, name='pharmacist_view_orders'),
   path('paid_orders_view/', views.paid_orders_view, name='paid_orders_view'),
   path('invoice_details/', views.invoice_details, name='invoice_details'),
   path('pharmacist_view_profit/', views.pharmacist_view_profit, name='pharmacist_view_profit'),
 
   # Doctor Views
   path('doctorHome/', views.doctorHome, name='doctorHome'),
   path('DoctorProfile/', views.DoctorProfile, name='DoctorProfile'),
   path('update_DoctorProfile/', views.update_DoctorProfile, name='update_DoctorProfile'),
   path('doc_view_bookings/', views.doc_view_bookings, name='doc_view_bookings'),
   path('accept_bookings/', views.accept_bookings, name='accept_bookings'),
   path('decline_booking/', views.decline_booking, name='decline_booking'),
   path('prescription_patient/', views.prescription_patient, name='prescription_patient'),
   path('dr_viewMedicine/', views.dr_viewMedicine, name='dr_viewMedicine'),
   path('dr_viewMedicinedetails/', views.dr_viewMedicinedetails, name='dr_viewMedicinedetails'),
 
   # User Views
   path('userHome/', views.userHome, name='userHome'),
   path('book_appoinment/', views.book_appoinment, name='book_appoinment'),
   path('view_bookedappointment/', views.view_bookedappointment, name='view_bookedappointment'),
   path('view_prescription/', views.view_prescription, name='view_prescription'),
   path('user_viewMedicine/', views.user_viewMedicine, name='user_viewMedicine'),
   path('user_viewMedicineDetails/', views.user_viewMedicineDetails, name='user_viewMedicineDetails'),
   path('add_to_cart/', views.add_to_cart, name='add_to_cart'),
   path('medicine_payment/', views.medicine_payment, name='medicine_payment'),
   path('place_order/', views.place_order, name='place_order'),
   path('confirmorder/', views.confirmorder, name='confirmorder'),
   path('UserProfile/', views.UserProfile, name='UserProfile'),
   path('update_userProfile/', views.update_userProfile, name='update_userProfile'),
   path('invoice/', views.invoice, name='invoice'),
]
 
 
SETTINGS.PY
from pathlib import Path
import os
 
BASE_DIR = Path(__file__).resolve().parent.parent
 
SECRET_KEY = 'django-insecure-sm1x&a@6+0t7=(e3*h2bl#d!eixmpo4pe$@e$8vx8p(hxdw3iy'
 
DEBUG = True
 
ALLOWED_HOSTS = []
 
INSTALLED_APPS = [
   'django.contrib.admin',
   'django.contrib.auth',
   'django.contrib.contenttypes',
   'django.contrib.sessions',
   'django.contrib.messages',
   'django.contrib.staticfiles',
   'myapp',
]
 
MIDDLEWARE = [
   'django.middleware.security.SecurityMiddleware',
   'django.contrib.sessions.middleware.SessionMiddleware',
   'django.middleware.common.CommonMiddleware',
   'django.middleware.csrf.CsrfViewMiddleware',
   'django.contrib.auth.middleware.AuthenticationMiddleware',
   'django.contrib.messages.middleware.MessageMiddleware',
   'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
 
ROOT_URLCONF = 'Pharmacy.urls'
 
TEMPLATES = [
   {
       'BACKEND': 'django.template.backends.django.DjangoTemplates',
       'DIRS': ['templates'],
       'APP_DIRS': True,
       'OPTIONS': {
           'context_processors': [
               'django.template.context_processors.debug',
               'django.template.context_processors.request',
               'django.contrib.auth.context_processors.auth',
               'django.contrib.messages.context_processors.messages',
           ],
       },
   },
]
 
WSGI_APPLICATION = 'Pharmacy.wsgi.application'
 
DATABASES = {
   'default': {
       'ENGINE': 'django.db.backends.sqlite3',
       'NAME': BASE_DIR / 'db.sqlite3',
   }
}
 
AUTH_PASSWORD_VALIDATORS = [
   {
       'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
   },
   {
       'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
   },
   {
       'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
   },
   {
       'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
   },
]
 
LANGUAGE_CODE = 'en-us'
 
TIME_ZONE = 'UTC'
 
USE_I18N = True
 
USE_TZ = True
 
STATIC_URL = 'static/'
STATICFILES_DIRS = [os.path.join(BASE_DIR, "static")]
 
MEDIA_URL = '/assets/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'static/assets')
 
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
AUTH_USER_MODEL = "myapp.Login"
